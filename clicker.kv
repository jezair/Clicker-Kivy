#:import from_hex kivy.utils.get_color_from_hex
#:import to_rgba kivy.utils.rgba
#:import colormap kivy.utils.colormap

#:set main_color '#FF6B35'
#:set main_color_dark "#CC4422"
#:set accent_color '#FFD700'
#:set bg_color '#0D47A1'
#:set text_color '#FFFFFF'

<Widget>:
    font_name: 'assets/Minecraft.ttf'


<ButtonMenu@Button>:
    font_size: "56sp"
    bold: True
    background_color: 0, 0, 0, 0
    size_hint: None, None
    pos_hint: {"center_x": 0.5}
    width: self.texture_size[0] + dp(60)
    color: 1, 1, 1, 1

    canvas.before:
        # Light transparent shadow
        Color:
            rgba: 0, 0, 0, 0.2
        RoundedRectangle:
            size: self.size[0] + dp(8), self.size[1] + dp(8)
            pos: self.pos[0] - dp(4), self.pos[1] - dp(4)
            radius: [dp(25)]
        # Main button background - higher contrast
        Color:
            rgba: 0.1, 0.4, 0.9, 1 if self.state == 'normal' else 0.05, 0.3, 0.8, 1
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [dp(25)]
        # Stronger inner glow
        Color:
            rgba: 0.7, 0.9, 1, 0.8
        RoundedRectangle:
            size: self.size[0] - dp(8), self.size[1] - dp(8)
            pos: self.pos[0] + dp(4), self.pos[1] + dp(4)
            radius: [dp(20)]


<ButtonIcon@ButtonMenu>:
    font_name: 'assets/typicons.ttf'
    font_size: "38sp"
    width: dp(60)
    height: dp(60)
    color: 1, 1, 1, 1
    
    canvas.before:
        # Light transparent shadow
        Color:
            rgba: 0, 0, 0, 0.2
        RoundedRectangle:
            size: self.size[0] + dp(6), self.size[1] + dp(6)
            pos: self.pos[0] - dp(3), self.pos[1] - dp(3)
            radius: [dp(15)]
        # Main button background - higher contrast red
        Color:
            rgba: 0.95, 0.2, 0.2, 1 if self.state == 'normal' else 0.8, 0.1, 0.1, 1
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [dp(15)]
        # Stronger inner highlight
        Color:
            rgba: 1, 0.6, 0.6, 0.6
        RoundedRectangle:
            size: self.size[0] - dp(6), self.size[1] - dp(6)
            pos: self.pos[0] + dp(3), self.pos[1] + dp(3)
            radius: [dp(12)]


<Menu>:
    BoxLayout:
        orientation: "vertical"
        padding: "30dp"
        spacing: "20dp"

        canvas:
            Rectangle:
                source: 'assets/back_ground.jpeg'
                size: self.size
                pos: self.pos

        Widget:
            size_hint_y: 0.15

        Label:
            text: "UNDERWATER\nCLICKER"
            font_size: "54sp"
            halign: "center"
            size_hint_y: 0.25
            color: 1, 1, 1, 1
            canvas.before:
                # Blur background
                Color:
                    rgba: 0, 0, 0, 0.6
                RoundedRectangle:
                    size: self.size[0] + dp(40), self.size[1] + dp(40)
                    pos: self.pos[0] - dp(20), self.pos[1] - dp(20)
                    radius: [dp(20)]
                # Additional blur layers
                Color:
                    rgba: 0.1, 0.1, 0.3, 0.4
                RoundedRectangle:
                    size: self.size[0] + dp(30), self.size[1] + dp(30)
                    pos: self.pos[0] - dp(15), self.pos[1] - dp(15)
                    radius: [dp(18)]
                Color:
                    rgba: 0.2, 0.2, 0.4, 0.3
                RoundedRectangle:
                    size: self.size[0] + dp(20), self.size[1] + dp(20)
                    pos: self.pos[0] - dp(10), self.pos[1] - dp(10)
                    radius: [dp(15)]

        BoxLayout:
            orientation: "vertical"
            size_hint_y: 0.7
            Image:
                id: title_image
                source: "assets/images/title.png"
                allow_stretch: False
                keep_ratio: True
                size_hint_y: None
                height: dp(500)

            ButtonMenu:
                text: " PLAY "
                size_hint_y: None
                height: dp(120)
                on_press:
                    root.go_game()

        Widget:
            size_hint_y: 0.0

        BoxLayout:
            size_hint_y: 0.15

            # Button "Settings"
            ButtonIcon:
                text: "\uE04F"
                on_press:
                    root.go_settings()

            Widget:

            # Button "Exit"
            ButtonIcon:
                text: "\uE121"
                on_press:
                    app.stop()


<Settings>:
    BoxLayout:
        orientation: "vertical"
        padding: "30dp"
        spacing: "20dp"

        Label:
            text: "Settings"
            font_size: "40sp"
            color: 1, 1, 1, 1
            canvas.before:
                # Blur background for settings title
                Color:
                    rgba: 0, 0, 0, 0.5
                RoundedRectangle:
                    size: self.size[0] + dp(30), self.size[1] + dp(30)
                    pos: self.pos[0] - dp(15), self.pos[1] - dp(15)
                    radius: [dp(15)]
                Color:
                    rgba: 0.1, 0.1, 0.3, 0.4
                RoundedRectangle:
                    size: self.size[0] + dp(20), self.size[1] + dp(20)
                    pos: self.pos[0] - dp(10), self.pos[1] - dp(10)
                    radius: [dp(12)]

        ButtonMenu:
            text: "Back"
            size_hint_y: 0.2
            on_press:
                root.go_menu()

<RotatedImage>:
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            axis: 0, 0, 1
            origin: self.center
    canvas.after:
        PopMatrix


<Fish>:
    source: 'assets/fish1.png'
    size_hint: None, None
    size: dp(200), dp(200)
    opacity: 0
    scale: 1.0
    canvas.before:
        PushMatrix
        Scale:
            origin: self.center
            x: self.scale
            y: self.scale
        Rotate:
            angle: self.angle
            axis: 0, 0, 1
            origin: self.center
    canvas.after:
        PopMatrix


<Game>:
    # Main container with no padding or margins
    FloatLayout:
        # Background GIF - will cover entire screen
        Image:
            id: gif_background
            size_hint: None, None
            size: root.width, root.height
            pos: 0, 0
            allow_stretch: True
            keep_ratio: False
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
                    texture: self.texture

        # Main content container
        BoxLayout:
            orientation: "vertical"
            padding: 0
            spacing: 0
            size_hint: 1, 1

            # Верхнє меню
            BoxLayout:
                size_hint_y: 0.12
                
                Widget:
                    size_hint_x: None
                    width: dp(70)
                
                # Текстовий напис "Бали"
                Label:
                    text: str(root.score)
                    font_size: '56sp'
                    size_hint_x: 0.4
                    pos_hint: {'center_x': 0.9}
                    halign: 'center'
                    color: 1, 1, 1, 1
                    canvas.before:
                        # Blur background for score
                        Color:
                            rgba: 0, 0, 0, 0.5
                        RoundedRectangle:
                            size: self.size[0] + dp(280), self.size[1] + dp(100)
                            pos: self.pos[0] - dp(220), self.pos[1] - dp(50)
                            radius: [dp(25)]
                        Color:
                            rgba: 0.1, 0.1, 0.3, 0.4
                        RoundedRectangle:
                            size: self.size[0] + dp(250), self.size[1] + dp(85)
                            pos: self.pos[0] - dp(200), self.pos[1] - dp(42)
                            radius: [dp(22)]
                        Color:
                            rgba: 0.2, 0.2, 0.4, 0.3
                        RoundedRectangle:
                            size: self.size[0] + dp(220), self.size[1] + dp(70)
                            pos: self.pos[0] - dp(180), self.pos[1] - dp(35)
                            radius: [dp(20)]

                # Кнопка-іконка "Дім"
                ButtonIcon:
                    text: '\uE08A'
                    width: dp(70)
                    height: dp(90)
                    color: 1, 1, 1, 1
                    canvas.before:
                        # Light transparent shadow
                        Color:
                            rgba: 0, 0, 0, 0.2
                        RoundedRectangle:
                            size: self.size[0] + dp(8), self.size[1] + dp(8)
                            pos: self.pos[0] - dp(4), self.pos[1] - dp(4)
                            radius: [dp(20)]
                        # Gradient background - higher contrast
                        Color:
                            rgba: 0.95, 0.2, 0.2, 1 if self.state == 'normal' else 0.8, 0.1, 0.1, 1
                        RoundedRectangle:
                            size: self.size
                            pos: self.pos
                            radius: [dp(20)]
                        # Stronger inner glow
                        Color:
                            rgba: 1, 0.6, 0.6, 0.8
                        RoundedRectangle:
                            size: self.size[0] - dp(8), self.size[1] - dp(8)
                            pos: self.pos[0] + dp(4), self.pos[1] + dp(4)
                            radius: [dp(16)]
                    on_press: root.go_home()

            # Ігрова область
            FloatLayout:
                size_hint_y: 0.76
                id: game_window

                Fish:
                    id: fish
                    center: root.center

                Label:
                    id: level_complete
                    text: '    Level\ncomplete!'
                    color: from_hex('#00FF88')
                    font_size: '50sp'
                    size_hint_y: None
                    height: self.texture_size[1]
                    x: root.width / 2 - self.width / 2
                    y: root.height / 2 - self.height / 2 + dp(100)
                    opacity: 0
                    canvas.before:
                        # Blur background for level complete
                        Color:
                            rgba: 0, 0, 0, 0.4
                        RoundedRectangle:
                            size: self.size[0] + dp(40), self.size[1] + dp(40)
                            pos: self.pos[0] - dp(20), self.pos[1] - dp(20)
                            radius: [dp(20)]
                        Color:
                            rgba: 0.1, 0.3, 0.1, 0.3
                        RoundedRectangle:
                            size: self.size[0] + dp(30), self.size[1] + dp(30)
                            pos: self.pos[0] - dp(15), self.pos[1] - dp(15)
                            radius: [dp(18)]
                        Color:
                            rgba: 0.2, 0.4, 0.2, 0.2
                        RoundedRectangle:
                            size: self.size[0] + dp(20), self.size[1] + dp(20)
                            pos: self.pos[0] - dp(10), self.pos[1] - dp(10)
                            radius: [dp(15)]

            # Нижнє меню
            BoxLayout:
                size_hint_y: 0.12
                spacing: "20dp"

                # Кнопка-іконка "Налаштування"
                ButtonMenu:
                    font_name: 'assets/typicons.ttf'
                    text: '\uE04F'
                    size_hint_x: None
                    font_size: '38sp'
                    pos_hint: {'y': 0}
                    on_press: root.go_settings()